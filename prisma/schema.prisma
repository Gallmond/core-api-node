generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Customer {
  id                   String  @id
  first_name           String
  last_name            String?
  email                String   @unique
  password             String
  avatar               String?
  created_at           DateTime @default(now())
  updated_at           DateTime @default(now())
  discussions          Discussion[]
  customer_discussions CustomerDiscussion[]
  messages             Message[]
}

model Discussion {
    id                   String  @id
    initiator            Customer @relation(fields: [initiator_id], references: [id])
    initiator_id         String
    state                String
    type                 String?
    created_at           DateTime @default(now())
    updated_at           DateTime @default(now())
    customer_discussions CustomerDiscussion[]
    messsages            Message[]
}

model CustomerDiscussion {
    id            String  @id
    customer      Customer @relation(fields: [customer_id], references: [id])
    customer_id   String
    discussion    Discussion @relation(fields: [discussion_id], references: [id])
    discussion_id String
    created_at    DateTime @default(now())
    updated_at    DateTime @default(now())
    deleted_at    DateTime?
    agreed_at     DateTime?
}

model Message {
id               String  @id
discussion       Discussion @relation(fields: [discussion_id], references: [id])
discussion_id    String
sender           Customer @relation(fields: [sender_id], references: [id])
sender_id        String
content          String
content_redacted String
created_at       DateTime @default(now())
updated_at       DateTime @default(now())
read_at          DateTime?
}